include mime.types;
server {
	listen 80;
	server_name localhost;
	root /usr/share/nginx/html;
	index index.html;

	# Security headers
	add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
	add_header X-Content-Type-Options "nosniff" always;
	add_header X-Frame-Options "DENY" always;
	add_header Referrer-Policy "strict-origin-when-cross-origin" always;
	add_header Content-Security-Policy "default-src 'self'; img-src 'self' https: data:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; script-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self' https:; upgrade-insecure-requests;" always;
	add_header Permissions-Policy "camera=(), microphone=(), geolocation=()" always;

	# Health check endpoint for load balancer / ECS
	location = /health {
		access_log off;
		return 200 'ok';
		add_header Content-Type text/plain;
	}

	location /assets/ {
		include mime.types;
		types {
			application/pdf pdf;
			application/javascript js mjs;
			application/json json;
			image/jpeg jpg jpeg;
			image/png png;
			image/svg svg;
			application/octet-stream bin zip;
		}
		root /usr/share/nginx/html;
		try_files $uri $uri/ =404;
		access_log off;
		expires max;
	}

	# Serve all Angular SPA routes by falling back to index.html
	location / {
		try_files $uri $uri/ /index.html;
	}
}
